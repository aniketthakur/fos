{% extends "base.html" %}
`

{% block maincontents %}
  <div class="page-title">
    <h3>Cash Flow Analysis <span class="bold"> (CFA)</span></h3>
  </div>

  <div class="grid simple">
    <div class="grid-body no-border invoice-body">
      <form id="cf_action" action="/application/{{ app_id }}/cashflow" method="post">
      <div class="row">
          <div class="col-md-4">
            <div class="form-group">
              <label class="form-label">Application ID</label>
              <div class="controls">
                <input type="text" value="{{ app_id }}" class="form-control" disabled>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="form-group">
              <label class="form-label">Name of the Customer</label>
              <div class="controls">
                <input type="text" value="{{ application.applicant_name }}" class="form-control" disabled>
              </div>
            </div>
          </div>
          <div class="col-md-3 pull-right">
            <div class="form-group">
              <label class="form-label">Cash Flow Verification Pending</label>
              <a class="btn btn-small btn-block btn-warning form-control cfa_failed" data-id="{{ app_id }}" type="button" href="#"><i class="fa fa-times"></i>CFA Failed</a></a>
              <a class="btn btn-small btn-block btn-success form-control cfa_passed" data-id="{{ app_id }}" type="button" href="#"><i class="fa fa-check"></i>CFA Passed</a></a>
            </div>
          </div>
      </div>
      <table class="table" cols=3>
        <thead>
          <tr>
            <th style="width:60px" class="unseen text-center"></th>
            <th class="text-left"></th>
            <th style="width:150px"></th>
          </tr>
        </thead>
        <tbody>
        <tr>
          <td colspan="3" >
            <h4 class="semi-bold">(A) Total Gross Income said at the time of Sourcing</h4>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">1</td>
          <td>Total Annual Revenue-Cash</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="Total Annual Revenue-Cash" value="{{ application.total_annual_revenue_cash }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">2</td>
          <td>Total Annual Revenue-Credit</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="Total Annual Revenue-Credit" value="{{ application.total_annual_revenue_credit }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center"></td>
          <td class="bold text-right">
            <strong>(A) Total Income</strong>
          </td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a-total" value="{{ application.average_monthly_income }}" disabled>
            </div>
          </td>
       </tr>
        <tr>
          <td colspan="3" >
            <h4 class="semi-bold">(B) Total Gross expenditure said at the time of sourcing</h4>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">5.1</td>
          <td>Monthly Rent(House)</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="monthly_rent" value="{{ application.house_monthly_rent}}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">5.2</td>
          <td>Average Monthly Bill(Phone)</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="average_monthly_bill_phone" value="{{ application.average_monthly_bill }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">5.3</td>
          <td>Average Monthly Bill(Electricity)</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="average_monthly_bill_electricity" value="{{ application.electricity_monthly_bill }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">5.4</td>
          <td>Average Monthly Expenses-Grocery</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="grocery_expenses" value="{{ application.grocery_expenses }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">5.5</td>
          <td>Average Monthly Expenses-Conveyance</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="conveyance_expenses" value="{{ application.conveyance_expenses }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">5.6</td>
          <td>Average Monthly Expenses-Medical</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="medical_expenses" value="{{ application.medical_expenses }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">5.7</td>
          <td>Average Monthly Expenses-Education</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="education_expenses" value="{{ application.education_expenses }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">5.8</td>
          <td>Average Monthly Expenses-Other</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="other_expenses" value="{{ application.family_other_expenses }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">6</td>
          <td>Monthly Rent(Business)</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="monthly_rent" value="{{ application.monthly_rent }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">7</td>
          <td>Business Monthly Expenses-Electricity Charges</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="electricity_charges" value="{{ application.electricity_charges }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">8</td>
          <td>Business Monthly Expenses-Petrol Expenses</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="petrol_expenses" value="{{ application.petrol_expenses }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">9</td>
          <td>Business Monthly Expenses-Freight Charges</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="freight_charges" value="{{ application.freight_charges }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">10</td>
          <td>Business Monthly Expenses-Salaries and Wages</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="salaries_and_wages" value="{{ application.salaries_and_wages }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">11</td>
          <td>Business Monthly Expenses-Other Expenses</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="other_expenses" value="{{ application.other_expenses }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">12</td>
          <td>EMI for Loans from Bank/FI 1</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="emi_payment1" value="{{ application.loan_details1.emi_repayments }}">
            </div>
          </td>
        </tr>
         <tr>
          <td class="unseen text-center">13</td>
          <td>EMI for Loans from Bank/FI 2</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="emi_payment2" value="{{ application.loan_details2.emi_repayments  }}">
            </div>
          </td>
        </tr>
         <tr>
          <td class="unseen text-center">14</td>
          <td>EMI for Loans from Bank/FI 3</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="emi_payment3" value="{{ application.loan_details3.emi_repayments  }}">
            </div>
          </td>
        </tr>
         <tr>
          <td class="unseen text-center">15</td>
          <td>EMI for Loans from Bank/FI 4</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="emi_payment4" value="{{ application.loan_details4.emi_repayments  }}">
            </div>
          </td>
        </tr>
        <tr>
             <tr>
          <td class="unseen text-center">16</td>
          <td>Others</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right" name="other_expense" value="{{ application.other_expense }}">
            </div>
          </td>
        </tr>
              <tr>
          <td class="unseen text-center">17</td>
          <td>Total Annual Purchase-Cash</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b1" name="total_annual_purchase_cash" value="{{ application.total_annual_purchase_cash }}">
            </div>
          </td>
        </tr>
              <tr>
          <td class="unseen text-center">18</td>
          <td>Total Annual Purchase-Credit</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b1" name="total_annual_purchase_credit" value="{{ application.total_annual_purchase_credit }}">
            </div>
          </td>
        </tr>
              <tr>
          <td class="unseen text-center">19</td>
          <td>Average Monthly Purchase</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b1-total" name="average_monthly_purchase" value="{{ application.average_monthly_purchase }}" disabled>
            </div>
          </td>
        </tr>
          <td class="unseen text-center">
          </td>
          <td class="bold text-right">
            <strong>(B) Total Expenditure</strong>
          </td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b-total" value="{{ application.total_expenditure}}" disabled>
            </div>
          </td>
        </tr>

        <tr>
          <td colspan="2" >
            <h6 class="semi-bold">Net Income (A-B)</h6>
          </td>
          <td>
            <div class="controls {% if application.loan_eligibility_based_on_net_income < application.applied_loan %}has-error{% endif %}">
              <input type="text" class="form-control text-right section-net-income" value="{{ application.net_income }}" disabled>
            </div>
          </td>
        </tr>
        <tr>
          <td colspan="2" >
            <h6 class="semi-bold">Expected Tenure In Months</h6>
          </td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right" name="expected_tenure_in_months" value="{{ application.expected_tenure_in_months }}">
            </div>
          </td>
        </tr>
        <tr>
          <td colspan="2" >
            <h6 class="semi-bold">Expected EMI can be served</h6>
          </td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right" name="expected_emi_amount_served" value="{{ application.expected_emi_amount_served }}">
            </div>
          </td>
        </tr>
        <tr>
          <td colspan="2" >
            <h6 class="semi-bold">Loan eligibility based on Net Income</h6>
          </td>
          <td>
            <div class="controls {% if application.loan_eligibility_based_on_net_income < application.applied_loan %}has-error{% endif %}">
              <input type="text" class="form-control text-right section-loan-eligibility" value="{{ application.loan_eligibility_based_on_net_income }}" disabled>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
      </form>
    </div>
  </div>
{% endblock %}


{% block js_scripts %}
    <script type="text/javascript">
        $(document).ready(function(){
            $(".section-a").on("change", function(e){
              var total = 0.0;
              $(".section-a").each(function(index){
                total += parseFloat($(this).val());
              })    ;
              $(".section-a-total").val(total/12);
              update_net_income();
              update_loan_eligibility();
            });

            $(".section-b1").on("change", function(e){
              var total = 0.0;
              $(".section-b1").each(function(index){
                total += parseFloat($(this).val());
              });
              $(".section-b1-total").val(total = total/12);
              $(".section-b").each(function(index){
                total += parseFloat($(this).val());
              });
              $(".section-b-total").val(total);
                console.log(total);
                 update_net_income();
                 update_loan_eligibility();
            });

            $(".section-b").on("change", function(e){
              var total = 0.0;
              $(".section-b1").each(function(index){
                total += parseFloat($(this).val());
              });
              $(".section-b1-total").val(total = total/12);
              $(".section-b").each(function(index){
                total += parseFloat($(this).val());
              });
              $(".section-b-total").val(total);
              update_net_income();
              update_loan_eligibility();
            });

            $(".section-d").on("change", function(e){
              var total = 0.0;
              $(".section-d").each(function(index){
                total += parseFloat($(this).val());
              });
              $(".section-d-total").val(total);
              update_net_income();
              update_loan_eligibility();
            });

            function update_net_income() {
              var total_income = parseFloat($(".section-a-total").val());
              var total_expenditure = parseFloat($(".section-b-total").val());
              var net_income = total_income - total_expenditure;
              $(".section-net-income").val(net_income);
            }

            function update_loan_eligibility() {
              var total_income = parseFloat($(".section-a-total").val());
              var total_expenditure = parseFloat($(".section-b-total").val());
              var total_loan_eligibility = (total_income - total_expenditure) / 2  * 24;
              $(".section-loan-eligibility").val(total_loan_eligibility);
            }

            $(".cfa_failed").click(function(e){
                e.preventDefault();
                $("#cf_action")
                    .append("<input type='hidden' name='status' value='false'>")
                    .submit();
                return false;
            });
            $(".cfa_passed").click(function(e){
                e.preventDefault();
                $("#cf_action")
                    .append("<input type='hidden' name='status' value='true'>")
                    .submit();
                return false;
            });
        });
    </script>
{% endblock %}