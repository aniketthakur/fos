{% extends "base.html" %}
{% block css_sheets %}{{ super() }}

{% endblock %}

{% block action_bar %}

{% endblock %}
{% block maincontents %}
    <div class="row">
        <h3>Admin <span class="semi-bold">Reports</span></h3>
        <br>
    </div>
    <div class="row">

        <div class="col-md-4">
            <select id="application_type"  style="width:100%">
                <option value="1">Master</option>
                <option value="2">Cheque Prefilled</option>
                <option value="7">Disbursed</option>
            </select>
        </div>
        <div class="col-md-8">
            <div class="input-daterange" id="datepicker" >
                <input type="text" class="input-small" name="start-date" id="start-date" />
                <span class="add-on" style="vertical-align: top;height:30px">to</span>
                <input type="text" class="input-small" name="end" id="end-date" />
                <a href="#" class="btn btn-small btn-sm btn-info" id="generate_button">Generate</a>
                <a href="#" class="btn btn-small btn-sm btn-info" id="generate_button_as_of">Reports as on Now</a>
            </div>
        </div>
    </div>



    <div class="row-fluid">

        <!--<div class="span12">-->
            <!--<div class="grid simple ">-->
                <!--<div class="grid-title">-->
                    <!--<h4>Application <span class="semi-bold">List</span></h4>-->
                <!--</div>-->
                <!--<div class="grid-body ">-->
                    <!--<table class="table table-hover table-condensed" id="example">-->
                        <!--<thead>-->
                        <!--<tr>-->
                            <!--<th style="width:1%" >-->
                                <!--<div class="checkbox check-default">-->
                                    <!--<input id="checkbox10" type="checkbox" value="1" class="checkall">-->
                                    <!--<label for="checkbox10"></label>-->
                                <!--</div>-->
                            <!--</th>-->
                            <!--<th style="width:10%">Application ID</th>-->
                            <!--<th style="width:20%">Applicant Name</th>-->
                            <!--<th style="width:10%">Group Name</th>-->
                            <!--<th style="width:10%">Source</th>-->
                            <!--<th style="width:10%">Date</th>-->

                        <!--</tr>-->
                        <!--</thead>-->
                        <!--<tbody>-->
                        <!--{% for app in  tagged_applications %}-->
                            <!--<tr >-->
                                <!--<td class="v-align-middle">-->
                                    <!--<div class="checkbox check-default">-->
                                        <!--<input id="checkbox{{ loop.index }}" type="checkbox" value="1">-->
                                        <!--<label for="checkbox{{ loop.index }}"></label>-->
                                    <!--</div>-->
                                <!--</td>-->
                                <!--<td class="v-align-middle "><ins>{{ app.application_id }}</ins></td>-->

<!--{#                                {% if app.upload_type=='AUTOMATIC_UPLOAD' %}#}-->
<!--{#                                {% else %}#}-->
<!--{#                                    <td class="v-align-middle clickable-row" data-href='/organisation/{{ app.organisation.id }}/application/{{ app.application_id }}/'><ins>{{ app.application_id }}</ins></td>#}-->
<!--{#                                {% endif %}#}-->
                                <!--<td class="v-align-middle">{{ app.applicant_name }}</td>-->
                                <!--<td class="v-align-middle">{{ app.group.group_name }}</td>-->
                                <!--<td class="v-align-middle"><span class="muted">{{ app.upload_type }}</span>-->
                                <!--</td>-->
                                <!--<td><span class="muted">{{ app.date_created }}</span>-->
                                <!--</td>-->

                            <!--</tr>-->
                        <!--{% endfor %}-->

                        <!--</tbody>-->
                    <!--</table>-->
                <!--</div>-->
            <!--</div>-->
        <!--</div>-->
    </div>
{% endblock %}
{% block js_scripts %}{{ super() }}
    <script src="{{ url_for('static', filename='js/bootstrap-datepicker.js') }}"></script>
    <script type="text/javascript">

        $(document).ready(function(){
            $("#application_type").select2({
                placeholder: "choose report type",
                allowClear: true
            });

            $(".clickable-row").click(function() {
                window.document.location = $(this).data("href");
            });
        });
        $(document).ready(function () {

            $('.input-daterange').datepicker({
                todayBtn: "linked"
            });
            $("#generate_button").click(function() {
                console.log($("#start-date").val());
                console.log($("#end-date").val());
                if(checkDateRange($("#start-date").val(),$("#end-date").val())){
                    window.open("/reports/download?all=false&type="+$("#application_type").val()+"&start_date="+$("#start-date").val()+"&end_date="+$("#end-date").val());
                }
            });
            $("#generate_button_as_of").click(function() {
                console.log($("#start-date").val());
                console.log($("#end-date").val());
                window.open("/reports/download?all=true&type="+$("#application_type").val());
            });

            function checkDateRange(start, end) {
                // Parse the entries
                var startDate = Date.parse(start);
                var endDate = Date.parse(end);
                var today = new Date();

                // Make sure they are valid
                if (isNaN(startDate)) {
                    Messenger().post("The start date provided is not valid, please enter a valid date !");

                    return false;
                }
                if (isNaN(endDate)) {
                    Messenger().post("The end date provided is not valid, please enter a valid date.");

                    return false;

                }
                // Check the date range, 86400000 is the number of milliseconds in one day
                var difference = (endDate - startDate) / (86400000 * 7);
                if (difference < 0) {
                    Messenger().post("The start date must come before the end date!...");
                    return false;

                }
                if (endDate - today > 0) {
                    Messenger().post("End date cannot be greater than today!...");
                    return false;
                }
                return true;
            }

        });
    </script>
{% endblock %}