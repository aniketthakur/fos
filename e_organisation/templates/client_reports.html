{% extends "base.html" %}


{% block maincontents %}
    <div class="row">
        <div class="col-md-12 form-group">
            <h3>Admin <span class="semi-bold">Reports</span></h3>
        </div>
    </div>

    <div class="row">
        <div class="col-md-3 form-group">
            <h4>Master Report</h4>
        </div>
        <div class="col-md-6">
            <div class="input-daterange">
                <!-- disabling internal main report issue#112. -->
                <form method="get" action="/reports">
                    <input type="text" class="input-small" name="start-date" id="start-date" placeholder="start-date" />
                    <input type="text" class="input-small" name="end-date" id="end-date" placeholder="end-date" />
                    <button class="btn btn-medium btn-md btn-info" id="generate_button" type="submit">Generate Report</button>
                </form>
            </div>
        </div>
        <div class="col-md-2 generate-button">
            <!-- disabling internal main report issue#112. -->
            <form method="get" action="/reports">
                <button class="btn btn-medium btn-md btn-info" id="generate_button_as_of">Generate Reports As On Now</button>
            </form>
        </div>
    </div>
{% endblock %}


{% block js_scripts %}{{ super() }}
    <script src="{{ url_for('static', filename='js/bootstrap-datepicker.js') }}"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#application_type").select2({
                placeholder: "choose report type",
                allowClear: true
            });
            $('.input-daterange').datepicker({
                todayBtn: "linked"
            });
            $("#generate_button").click(function() {
                checkDateRange($("#start-date").val(), $("#end-date").val())
            });
            function checkDateRange(start, end) {
                // Parse the entries
                var startDate = Date.parse(start);
                var endDate = Date.parse(end);
                var today = new Date();

                // Make sure they are valid
                if (isNaN(startDate)) {
                    Messenger().post("The start date provided is not valid, please enter a valid date !");

                    return false;
                }
                if (isNaN(endDate)) {
                    Messenger().post("The end date provided is not valid, please enter a valid date.");

                    return false;

                }
                // Check the date range, 86400000 is the number of milliseconds in one day
                var difference = (endDate - startDate) / (86400000 * 7);
                if (difference < 0) {
                    Messenger().post("The start date must come before the end date!...");
                    return false;

                }
                if (endDate - today > 0) {
                    Messenger().post("End date cannot be greater than today!...");
                    return false;
                }
                return true;
            }
        });
    </script>
{% endblock %}