{% extends "base.html" %}


{% block maincontents %}
  <div class="page-title">
    <h3>Cash Flow Analysis <span class="bold"> (CFA)</span></h3>
  </div>

  <div class="grid simple">
    <div class="grid-body no-border invoice-body">
      <form id="cf_action" action="/application/{{ app_id }}/cashflow" method="post">
      <div class="row">
          <div class="col-md-4">
            <div class="form-group">
              <label class="form-label">Application ID</label>
              <div class="controls">
                <input type="text" value="{{ app_id }}" class="form-control" disabled>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="form-group">
              <label class="form-label">Name of the Customer</label>
              <div class="controls">
                <input type="text" value="{{ application.applicant_name }}" class="form-control" disabled>
              </div>
            </div>
          </div>
          <div class="col-md-3 pull-right">
            <div class="form-group">
              <label class="form-label">Cash Flow Verification Pending</label>
              <a class="btn btn-small btn-block btn-warning form-control cfa_failed" data-id="{{ app_id }}" type="button" href="#"><i class="fa fa-times"></i>CFA Failed</a></a>
              <a class="btn btn-small btn-block btn-success form-control cfa_passed" data-id="{{ app_id }}" type="button" href="#"><i class="fa fa-check"></i>CFA Passed</a></a>
            </div>
          </div>
      </div>
      <table class="table" cols=3>
        <thead>
          <tr>
            <th style="width:60px" class="unseen text-center"></th>
            <th class="text-left"></th>
            <th style="width:150px"></th>
          </tr>
        </thead>
        <tbody>
        <tr>
          <td colspan="3" >
            <h4 class="semi-bold">(A) Total Gross Income said at the time of Sourcing</h4>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">1</td>
          <td>Sales Revenue in First Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_1_month" value="{{ application.sales_revenue_in_1_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">2</td>
          <td>Sales Revenue in Second Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_2_month" value="{{ application.sales_revenue_in_2_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">3</td>
          <td>Sales Revenue in Third Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_3_month" value="{{ application.sales_revenue_in_3_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">4</td>
          <td>Sales Revenue in Fourth Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_4_month" value="{{ application.sales_revenue_in_4_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">5</td>
          <td>Sales Revenue in Fifth Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_5_month" value="{{ application.sales_revenue_in_5_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">6</td>
          <td>Sales Revenue in Sixth Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_6_month" value="{{ application.sales_revenue_in_6_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">7</td>
          <td>Sales Revenue in Seventh Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_7_month" value="{{ application.sales_revenue_in_7_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">8</td>
          <td>Sales Revenue in Eight Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_8_month" value="{{ application.sales_revenue_in_8_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">9</td>
          <td>Sales Revenue in Nineth Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_9_month" value="{{ application.sales_revenue_in_9_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">10</td>
          <td>Sales Revenue in Tenth Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_10_month" value="{{ application.sales_revenue_in_10_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">11</td>
          <td>Sales Revenue in Eleventh Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_11_month" value="{{ application.sales_revenue_in_11_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">12</td>
          <td>Sales Revenue in Twelfth Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_12_month" value="{{ application.sales_revenue_in_12_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">13</td>
          <td>Total Annual Revenue-Cash</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="Total Annual Revenue-Cash" value="{{ application.total_annual_revenue_cash }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">14</td>
          <td>Total Annual Revenue-Credit</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="Total Annual Revenue-Credit" value="{{ application.total_annual_revenue_credit }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center"></td>
          <td class="bold text-right">
            <strong>(A) Total Income</strong>
          </td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a-total" value="{{ application.average_monthly_income }}" disabled>
            </div>
          </td>
       </tr>
        <tr>
          <td colspan="3" >
            <h4 class="semi-bold">(B) Total Gross expenditure said at the time of sourcing</h4>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">1</td>
          <td>Raw Material Purchase for First Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="Raw Material Purchase for First Month" value="{{ application.raw_material_purchase_in_1_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">2</td>
          <td>Raw Material Purchase for Second Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="Raw Material Purchase for Second Month" value="{{ application.raw_material_purchase_in_2_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">3</td>
          <td>Raw Material Purchase for Third Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="Raw Material Purchase for Third Month" value="{{ application.raw_material_purchase_in_3_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">4</td>
          <td>Raw Material Purchase for Fourth Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="Raw Material Purchase for Fourth Month" value="{{ application.raw_material_purchase_in_4_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">5</td>
          <td>Raw Material Purchase for Fifth Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="Raw Material Purchase for Fifth Month" value="{{ application.raw_material_purchase_in_5_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">6</td>
          <td>Raw Material Purchase for Sixth Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="Raw Material Purchase for Sixth Month" value="{{ application.raw_material_purchase_in_6_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">7</td>
          <td>Raw Material Purchase for Seventh Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="Raw Material Purchase for Seventh Month" value="{{ application.raw_material_purchase_in_7_month }}">
            </div>
          </td>
        </tr>
         <tr>
          <td class="unseen text-center">8</td>
          <td>Raw Material Purchase for Eight Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="Raw Material Purchase for Eighth Month" value="{{ application.raw_material_purchase_in_8_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">9</td>
          <td>Raw Material Purchase for Nineth Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="Raw Material Purchase for Nineth Month" value="{{ application.raw_material_purchase_in_9_month }}">
            </div>
          </td>
        </tr>
         <tr>
          <td class="unseen text-center">10</td>
          <td>Raw Material Purchase for Tenth Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="Raw Material Purchase for Tenth Month" value="{{ application.raw_material_purchase_in_10_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">11</td>
          <td>Raw Material Purchase for Eleventh Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="Raw Material Purchase for Eleventh Month" value="{{ application.raw_material_purchase_in_11_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">12</td>
          <td>Raw Material Purchase for Twelfth Month</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="Raw Material Purchase for Twelfth Month" value="{{ application.raw_material_purchase_in_12_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">5.1</td>
          <td>Wages and Salaries</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="monthly_rent" value="{{ application.house_monthly_rent}}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">5.2</td>
          <td>Utilities</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="average_monthly_bill_phone" value="{{ application.average_monthly_bill }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">5.3</td>
          <td>Fuel</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="average_monthly_bill_electricity" value="{{ application.electricity_monthly_bill }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">5.4</td>
          <td>Transport</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="grocery_expenses" value="{{ application.grocery_expenses }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">5.5</td>
          <td>Selling Expense</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="conveyance_expenses" value="{{ application.conveyance_expenses }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">5.6</td>
          <td>Loan Repayment</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="medical_expenses" value="{{ application.medical_expenses }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">5.7</td>
          <td>Other Expense</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="education_expenses" value="{{ application.education_expenses }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">5.8</td>
          <td>TOTAL</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="other_expenses" value="{{ application.family_other_expenses }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">6</td>
          <td>PBT</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="monthly_rent" value="{{ application.monthly_rent }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">7</td>
          <td>Tax</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="electricity_charges" value="{{ application.electricity_charges }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">8</td>
          <td>PAT</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="petrol_expenses" value="{{ application.petrol_expenses }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">9</td>
          <td>House hold expense</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="freight_charges" value="{{ application.freight_charges }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">10</td>
          <td>CASH SURPLUS</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="salaries_and_wages" value="{{ application.salaries_and_wages }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">11</td>
          <td>LOWEST SURPLUS RATIO</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="other_expenses" value="{{ application.other_expenses }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">12</td>
          <td>EMI TO CASH SURPLUS</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="emi_payment1" value="{{ application.loan_details1.emi_repayments }}">
            </div>
          </td>
        </tr>
         <tr>
          <td class="unseen text-center">13</td>
          <td>TOTAL LOAN OUTSTANDING TO SALES</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-b" name="emi_payment2" value="{{ application.loan_details2.emi_repayments  }}">
            </div>
          </td>
        </tr>
        </tbody>
      </table>
      <table class="table" cols=4>
        <thead>
          <tr>
            <th style="width:60px" class="unseen text-center"></th>
            <th class="text-left"></th>
            <th style="width:100px"></th>
            <th style="width:100px"></th>
          </tr>
        </thead>
        <tbody>
        <tr>
          <td colspan="2" >
            <h4 class="semi-bold">(C) IF ITR IS GIVEN</h4>
          </td>
         <td>CURRENT</td>
         <td>PREVIOUS</td>
        </tr>
        <tr>
          <td class="unseen text-center">1</td>
          <td>FILING DATE</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_1_month" value="{{ application.sales_revenue_in_1_month }}">
            </div>
          </td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_1_month" value="{{ application.sales_revenue_in_1_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">2</td>
          <td>YEAR</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_2_month" value="{{ application.sales_revenue_in_2_month }}">
            </div>
          </td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_1_month" value="{{ application.sales_revenue_in_1_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">3</td>
          <td>AMOUNT</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_3_month" value="{{ application.sales_revenue_in_3_month }}">
            </div>
          </td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_1_month" value="{{ application.sales_revenue_in_1_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">4</td>
          <td>ACKNOWLEDGED</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_2_month" value="{{ application.sales_revenue_in_2_month }}">
            </div>
          </td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_1_month" value="{{ application.sales_revenue_in_1_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">5</td>
          <td>APPLI/CO APPLI</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_3_month" value="{{ application.sales_revenue_in_3_month }}">
            </div>
          </td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_1_month" value="{{ application.sales_revenue_in_1_month }}">
            </div>
          </td>
        </tr>
        </tbody>
        </table>
        <table class="table" cols=4>
        <thead>
          <tr>
            <th style="width:60px" class="unseen text-center"></th>
            <th class="text-left"></th>
            <th style="width:100px"></th>
            <th style="width:100px"></th>
          </tr>
        </thead>
        <tbody>
        <tr>
          <td colspan="4" >
            <h4 class="semi-bold">(D) SALES VARIATION</h4>
          </td>
        </tr>
        <tr>
         <td colspan="2"></td>
         <td>CURRENT</td>
         <td>PREVIOUS</td>
        </tr>
        <tr>
          <td class="unseen text-center">1</td>
          <td>LOWEST SALES</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_1_month" value="{{ application.sales_revenue_in_1_month }}">
            </div>
          </td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_1_month" value="{{ application.sales_revenue_in_1_month }}">
            </div>
          </td>
        </tr>
        <tr>
          <td class="unseen text-center">2</td>
          <td>CASH SURPLUS IN</td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_2_month" value="{{ application.sales_revenue_in_2_month }}">
            </div>
          </td>
          <td>
            <div class="controls">
              <input type="text" class="form-control text-right section-a" name="sales_revenue_in_1_month" value="{{ application.sales_revenue_in_1_month }}">
            </div>
          </td>
        </tr>
        </tbody>
        </table>
      </form>
    </div>
  </div>
{% endblock %}


{% block js_scripts %}
    <script type="text/javascript">
        $(document).ready(function(){
            $(".section-a").on("change", function(e){
              var total = 0.0;
              $(".section-a").each(function(index){
                total += parseFloat($(this).val());
              })    ;
              $(".section-a-total").val(total/12);
              update_net_income();
              update_loan_eligibility();
            });

            $(".section-b1").on("change", function(e){
              var total = 0.0;
              $(".section-b1").each(function(index){
                total += parseFloat($(this).val());
              });
              $(".section-b1-total").val(total = total/12);
              $(".section-b").each(function(index){
                total += parseFloat($(this).val());
              });
              $(".section-b-total").val(total);
                console.log(total);
                 update_net_income();
                 update_loan_eligibility();
            });

            $(".section-b").on("change", function(e){
              var total = 0.0;
              $(".section-b1").each(function(index){
                total += parseFloat($(this).val());
              });
              $(".section-b1-total").val(total = total/12);
              $(".section-b").each(function(index){
                total += parseFloat($(this).val());
              });
              $(".section-b-total").val(total);
              update_net_income();
              update_loan_eligibility();
            });

            $(".section-d").on("change", function(e){
              var total = 0.0;
              $(".section-d").each(function(index){
                total += parseFloat($(this).val());
              });
              $(".section-d-total").val(total);
              update_net_income();
              update_loan_eligibility();
            });

            function update_net_income() {
              var total_income = parseFloat($(".section-a-total").val());
              var total_expenditure = parseFloat($(".section-b-total").val());
              var net_income = total_income - total_expenditure;
              $(".section-net-income").val(net_income);
            }

            function update_loan_eligibility() {
              var total_income = parseFloat($(".section-a-total").val());
              var total_expenditure = parseFloat($(".section-b-total").val());
              var total_loan_eligibility = (total_income - total_expenditure) / 2  * 24;
              $(".section-loan-eligibility").val(total_loan_eligibility);
            }

            $(".cfa_failed").click(function(e){
                e.preventDefault();
                $("#cf_action")
                    .append("<input type='hidden' name='status' value='false'>")
                    .submit();
                return false;
            });
            $(".cfa_passed").click(function(e){
                e.preventDefault();
                $("#cf_action")
                    .append("<input type='hidden' name='status' value='true'>")
                    .submit();
                return false;
            });
        });
    </script>
{% endblock %}