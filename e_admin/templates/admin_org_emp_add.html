{% extends "base.html" %}


{% block maincontents %}
  <div class="row">
    <div class="col-md-12">
      <div class="grid simple">
        <div class="grid-body grid-page-title">
          <h3 class="inline">Add <span class="semi-bold">Employee</span></h3>
          <h3 class="v-align-middle pull-right"><a href="{{ url_for("admin_views.admin_organisation_dashboard", org_id=org.id) }}">{{ org.name }}</a></h3>
          <div class="clearfix"></div>
        </div>
        <div class="grid-body">
          {% with messages = get_flashed_messages() %}
            {% if messages %}
              <ul class=flashes>
                {% for message in messages %}
                  <li>{{ message }}</li>
                {% endfor %}
              </ul>
            {% endif %}
          {% endwith %}
            <form class="form-no-horizontal-spacing" id="form-organisation-emp" method="post" action="{{ url_for("admin_views.admin_organisation_add_emp", org_id=org.id) }}">
              <div class="row column-seperation">
                <div class="col-md-6">
                  <h4>Basic Information </h4>
                  <div class="row form-row">
                    <div class="col-md-7">
                      <div class="input-with-icon  right">
                        <input name="first_name_add_organisation" type="text" class="form-control" placeholder="First Name" maxlength="30">
                      </div>
                    </div>
                    <div class="col-md-5">
                      <div class="input-with-icon  right">
                        <input name="last_name_add_organisation" type="text" class="form-control" placeholder="Last Name" maxlength="30">
                      </div>
                    </div>
                  </div>
                  <div class="row form-row">
                    <div class="col-md-7">
                      <div class="input-with-icon  right">
                        <input name="email_add_organisation" type="text" class="form-control" placeholder="user-name@{{ org.domain }}" minlength="3" maxlength="100" value="user-name@{{ org.domain }}">
                      </div>
                    </div>
                    <div class="col-md-5">
                      <div class="input-with-icon  right">
                        <input name="password_add_organisation" type="password" class="form-control" placeholder="password" minlength="3" maxlength="30">
                      </div>
                    </div>
                  </div>
                  <div class="row form-row">
                    <div class="col-md-5">
                      <div class="input-append success date no-padding">
                        <input name="date_of_birth_add_organisation" type="text" class="form-control" placeholder="Date of Birth" >
                        <span class="add-on"><span class="arrow"></span><i class="fa fa-th"></i></span>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="radio form-group">
                        <input id="male" type="radio" name="gender" value="male" checked="checked">
                        <label for="male">Male</label>
                        <input id="female" type="radio" name="gender" value="female">
                        <label for="female">Female</label>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-group">
                        <input id="active" type="checkbox" name="active" value="active" checked="checked">
                        <label class="checkbox-inline" for="account_status">Active</label>
                      </div>
                    </div>
                  </div>
                  <h4>Hierarchy</h4>
                  <div class="row form-row">
                    <div class="col-md-12 form-group">
                      <select name="role" id="role" class="select2 form-control">
                        <option selected disabled>select designation</option>
                        {% for designation in hierarchy %}
                        <option value="{{ designation.id }}" data-level="{{ designation.level }}">({{ designation.title|upper }}) {{ designation.title_full|upper }}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <h4>Postal Information</h4>
                  <div class="row form-row">
                    <div class="col-md-12">
                      <div class="input-with-icon  right">
                        <input name="address_add_org_emp" type="text" class="form-control" placeholder="Address">
                      </div>
                    </div>
                  </div>
                  <div class="row form-row">
                    <div class="col-md-6 form-group">
                      <div class="input-with-icon  right">
                        <select name="country_add_organisation" class="form-control select2" id="postal_country" placeholder="Country"></select>
                      </div>
                    </div>
                    <div class="col-md-6 ">
                      <div class="input-with-icon  right">
                        <select name="state_add_organisation" class="form-control select2" id="postal_state" placeholder="State"></select>
                      </div>
                    </div>
                  </div>
                  <div class="row form-row">
                    <div class="col-md-6 ">
                      <div class="input-with-icon  right">
                        <input name="city_add_organisation" type="text" class="form-control" placeholder="City" maxlength="30">
                      </div>
                    </div>
                    <div class="col-md-6 ">
                      <div class="input-with-icon  right">
                        <input name="postal_code_add_organisation" type="text" class="form-control" placeholder="Postal Code" minlength="5" maxlength="6">
                      </div>
                    </div>
                  </div>
                  <div class="row form-row">
                    <div class="col-md-4 ">
                      <div class="input-with-icon  right">
                        <input name="tele_code_add_organisation" type="text" class="form-control" placeholder="+91" minlength="1" maxlength="2">
                      </div>
                    </div>
                    <div class="col-md-8 ">
                      <div class="input-with-icon  right">
                        <input name="teleno_add_organisation" type="text" class="form-control" placeholder="Phone Number" maxlength="10">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-actions">
                <div class="pull-right">
                  <button class="btn btn-small btn-danger btn-cons" type="submit">Add Employee</button>
                  <button class="btn btn-small btn-white btn-cons cancel-button" type="reset" value="clear">Cancel</button>
                </div>
              </div>
            </form>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
      <div class="col-md-12">
          <div class="grid simple ">
              <div class="grid-title">
                  <h4> <span class="semi-bold">Employees</span></h4>
              </div>
              <div class="grid-body ">
                  <table class="table table-hover table-condensed" id="organisation-emp-table">
                      <thead>
                      <tr >
                          <th style="width:1%" >#</th>
                          <th style="width:15%">NAME</th>
                          <th style="width:5%">ROLES</th>
                          <th style="width:20%">EMAIL</th>
                          <th style="width:5%">PHONE NUMBER</th>
                          <th style="width:5%">ACTIVE</th>
                          <th style="width:5%">UPDATE</th>
                          <th style="width:5%">CHANGE PASSWORD</th>
                      </tr>
                      </thead>
                      <tbody>
                      {% for emp in employees %}
                          <tr>
                              <td class="v-align-middle">{{ loop.index }}</td>
                              <td class="v-align-middle">{{ emp.name }}</td>
                              <td class="v-align-middle">{{ emp.hierarchy.title|upper }}</td>
                              <td class="v-align-middle">{{ emp.email }}</td>
                              <td class="v-align-middle">{{ emp.postal_telephone }}</td>
                              <td class="v-align-middle"><a href="#" class="btn btn-small btn-cons {{ emp.active|enabledbutton }}">{{ emp.active|enabledfilter }}</a></td>
                              <td class="v-align-middle">
                                <a href="{{ url_for("admin_views.admin_organisation_add_emp_details", org_id=org.id, emp_id=emp.id) }}" class="btn btn-small btn-info" >Update</a>
                              </td>
                              <td class="v-align-middle">
                                <a href="{{ url_for("admin_views.admin_organisation_emp_password", org_id=org.id, emp_id=emp.id) }}" class="btn btn-small btn-info" >Change Password</a>
                              </td>
                          </tr>
                      {% endfor %}
                      </tbody>
                  </table>
              </div>
          </div>
      </div>
  </div>
{% endblock %}


{% block js_scripts %}
  <script src="{{ url_for('static', filename='js/countries.js') }}" type="text/javascript"></script>
  <script type="text/javascript">
    $(document).ready(function(){

      populateCountries("postal_country", "postal_state", {});
      $("#postal_country").select2();
      $("#postal_state").select2();
      $("#role").select2({
        placeholder: "Select a ROLE",
        allowClear: true
      });
      $("#branch").select2({
        placeholder: "Select a ROLE",
        allowClear: true
      });
      $("#state").select2({
        placeholder: "Select a ROLE",
        allowClear: true
      });
      $("#area").select2({
        placeholder: "Select a ROLE",
        allowClear: true
      });
      $("#region").select2({
        placeholder: "Select a ROLE",
        allowClear: true
      });

      $(':input','#form-organisation')
          .not(':button, :submit, :reset, :hidden')
          .val('')
          .removeAttr('checked')
          .removeAttr('selected');

      $.validator.addMethod("loginRegex", function(value, element) {
          return this.optional(element) || /^[a-z0-9\-\s]+\@{{ org.domain }}$/i.test(value);
      }, "username must contain only letters, numbers, or dashes.");

      $('#form-organisation-emp').validate({
        errorElement: 'span',
        errorClass: 'error',
        focusInvalid: false,
        ignore: "",
        rules: {
          first_name_add_organisation: {
            minlength: 2,
            maxlength: 30,
            required: true,
            lettersonly: true
          },
          last_name_add_organisation: {
            minlength: 2,
            maxlength: 30,
            required: true,
            lettersonly: true
          },
          email_add_organisation: {
            minlength: 3,
            maxlength: 100,
            required: true,
            loginRegex: true
          },
          password_add_organisation: {
            minlength: 3,
            maxlength: 30,
            required: true
          },
          address_add_org_emp: {
            minlength: 2,
            required: true
          },
          city_add_organisation: {
            minlength: 2,
            maxlength: 30,
            required: true,
            lettersonly: true
          },
          postal_code_add_organisation: {
            number:true,
            minlength: 5,
            maxlength: 6,
            required: true
          },
          teleno_add_organisation: {
            number:true,
            minlength: 10,
            maxlength: 10,
            required: true
          },
          tele_code_add_organisation: {
            minlength: 1,
            maxlength: 2,
            number:true,
            required: true
          }
        },
        invalidHandler: function (event, validator) {
          //display error alert on form submit
        },
        errorPlacement: function (error, element) { // render error placement for each input type
          var icon = $(element).parent('.input-with-icon').children('i');
          var parent = $(element).parent('.input-with-icon');
          icon.removeClass('fa fa-check').addClass('fa fa-exclamation');
          parent.removeClass('success-control').addClass('error-control');
        },
        highlight: function (element) { // hightlight error inputs
          var parent = $(element).parent();
          parent.removeClass('success-control').addClass('error-control');
        },
        unhighlight: function (element) { // revert the change done by hightlight

        },
        success: function (label, element) {
          var icon = $(element).parent('.input-with-icon').children('i');
          var parent = $(element).parent('.input-with-icon');
          icon.removeClass("fa fa-exclamation").addClass('fa fa-check');
          parent.removeClass('error-control').addClass('success-control');
        },
        submitHandler: function (form) {
          form.submit();
        }
      });
      $('.cancel-button').click(function(){
          location.href = '{{ url_for("admin_views.admin_organisation_dashboard", org_id=org.id) }}';
      });
      $('.input-append.date').datepicker({
        autoclose: true,
        todayHighlight: true
      });
    });
  </script>
{% endblock %}
